{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "autosize": { "type": "fit", "contains": "padding", "resize": true },
  "padding": 5,

  "data": { "name": "dataset" },

  "transform": [
    { "calculate": "toDate(datum['Date'])", "as": "DateParsed" }
  ],

  "datasets": {
    "extent": [
      {}
    ]
  },

  "vconcat": [
    {
      "data": { "name": "dataset" },
      "transform": [
        { "calculate": "toDate(datum['Date'])", "as": "DateParsed" }
      ],
      "layer": [
        {
          "transform": [
            {
              "aggregate": [
                { "op": "min", "field": "Average of Total Head", "as": "yMin" },
                { "op": "max", "field": "Average of Total Head", "as": "yMax" }
              ]
            },
            { "calculate": "0.7", "as": "topFrac" },
            {
              "calculate": "(datum.yMax - datum.yMin) * ((1 - datum.topFrac) / datum.topFrac)",
              "as": "extraBelow"
            },
            { "calculate": "datum.yMin - datum.extraBelow", "as": "domainMin" }
          ],
          "mark": { "type": "point", "opacity": 0 },
          "encoding": {
            "x": { "value": 0 }
          }
        },
        {
          "mark": { "type": "line" },
          "encoding": {
            "x": {
              "field": "DateParsed",
              "type": "temporal",
              "title": "Date",
              "axis": { "labelAngle": -45, "labelAlign": "right" }
            },
            "y": {
              "field": "Average of Total Head",
              "type": "quantitative",
              "title": "Total Head",
              "scale": {
                "zero": false,
                "nice": true,
                "domainMin": { "expr": "data('layer_0')[0].domainMin" }
              }
            },
            "color": {
              "field": "Drillhole_USC",
              "type": "nominal",
              "title": "Drillhole USC"
            }
          }
        }
      ]
    }
  ]
}
