{
  "$schema": "https://vega.github.io/schema/vega/v5.json",
  "width": 800,
  "height": 400,
  "padding": 5,
  "data": [
    { "name": "dataset" }
  ],
  "signals": [
    {
      "name": "headExtent",
      "update": "extent('dataset','Sum of Avg_Total_Head')"
    },
    {
      "name": "headMin",
      "update": "floor(headExtent[0])"
    },
    {
      "name": "headMax",
      "update": "ceil(headExtent[1])"
    },
    {
      "name": "precipExtent",
      "update": "extent('dataset','Sum of Precip_tot')"
    },
    {
      "name": "precipMax",
      "update": "precipExtent[1]"
    },
    {
      "name": "precipFactor",
      "update": "(height * 0.3) / precipMax"
    }
  ],
  "scales": [
    {
      "name": "xscale",
      "type": "time",
      "domain": {"data": "dataset", "field": "DateOnly"},
      "range": "width"
    },
    {
      "name": "yscaleHead",
      "type": "linear",
      "domain": {"signal": "[headMin, headMax]"},
      "range": ["height", 0],
      "nice": true
    },
    {
      "name": "yscalePrecip",
      "type": "linear",
      "domain": [0, {"signal": "precipMax"}],
      "range": ["height", 0],
      "nice": true
    },
    {
      "name": "color",
      "type": "ordinal",
      "domain": {"data": "dataset", "field": "Drillhole_USC"},
      "range": "category"
    }
  ],
  "axes": [
    {"orient": "bottom", "scale": "xscale", "title": "Date"},
    {"orient": "left", "scale": "yscaleHead", "title": "Avg Total Head", "titleColor": "#1f77b4"},
    {"orient": "right", "scale": "yscalePrecip", "title": "Precipitation (mm)", "titleColor": "#ff7f0e"}
  ],
  "marks": [
    {
      "type": "group",
      "from": {
        "facet": {
          "data": "dataset",
          "name": "drillhole",
          "groupby": "Drillhole_USC"
        }
      },
      "marks": [
        {
          "type": "line",
          "from": {"data": "drillhole"},
          "encode": {
            "enter": {
              "x": {"scale": "xscale", "field": "DateOnly"},
              "y": {"scale": "yscaleHead", "field": "Sum of Avg_Total_Head"},
              "stroke": {"scale": "color", "field": "Drillhole_USC"},
              "strokeWidth": {"value": 2}
            }
          }
        }
      ]
    },
    {
      "type": "rect",
      "from": {"data": "dataset"},
      "encode": {
        "enter": {
          "x": {"scale": "xscale", "field": "DateOnly"},
          "x2": {"scale": "xscale", "field": "DateOnly", "offset": 5},
          "y": {
            "signal": "height - datum['Sum of Precip_tot'] * precipFactor"
          },
          "y2": {"signal": "height"},
          "fill": {"value": "#ff7f0e"},
          "opacity": {"value": 0.4}
        }
      }
    }
  ]
}
